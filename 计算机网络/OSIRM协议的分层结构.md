# OSI/RM协议的分层结构

## tcp/IP五层协议的体系结构

这五层从下到上分别是：**物理层、数据链路层、网络层、传输层和应用层**。

我们可以用一个形象的比喻来理解：**寄送一封国际信件**

- •**应用层**：你写的信的内容（中文）、格式（抬头、落款）。关心的是“表达什么”。
- •**传输层**：把信纸装入信封，写上收件人、寄件人的**姓名和门牌号**（端口号），并决定是用平邮还是挂号信（可靠传输还是不可靠传输）。
- •**网络层**：在信封上写上收件人和寄件人的**城市和街道地址**（IP地址），决定信要发往哪个城市，走哪条路线。
- •**数据链路层**：负责信件在**一个街区或一个城市内**（一个局域网内）的传递。邮递员根据街道地址（MAC地址）将信投递到下一个中转站或目标大楼的邮箱。
- •**物理层**：邮递员骑的自行车、卡车、飞机等交通工具，以及道路本身。关心的是信如何变成0/1光电气信号在网线或空气中传播

### 各层的详细职责、关键协议和数据单位

| 层次 (Layer)      | 功能描述                                                     | 关键协议                                                     | 数据单位 (PDU)                                     |
| :---------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :------------------------------------------------- |
| **5. 应用层**     | 为用户提供网络服务接口，负责处理应用程序的逻辑。**为应用程序产生待发送的数据。** | **HTTP** (网页)、**HTTPS** (安全网页)、**FTP** (文件传输)、**SMTP/POP3** (电子邮件)、**DNS** (域名解析)、**WebSocket** | **报文/消息** (Message)                            |
| **4. 传输层**     | 为应用层提供端到端（进程到进程）的通信服务。**负责数据的可靠性、流量控制和差错校验。** | **TCP** (传输控制协议 - 可靠、面向连接)、**UDP** (用户数据报协议 - 不可靠、无连接) | **段** (Segment - TCP) **数据报** (Datagram - UDP) |
| **3. 网络层**     | 负责将数据包从源主机**跨越多个网络**路由到目标主机。**进行逻辑寻址（IP地址）和路径选择。** | **IP** (网际协议)、**ICMP** ( ping / traceroute )、**ARP** (地址解析协议)、**路由器** | **包** (Packet)                                    |
| **2. 数据链路层** | 负责在**同一局域网内**的两个设备之间传递数据帧。**进行物理寻址（MAC地址）和差错校验。** | **以太网 (Ethernet)**、**Wi-Fi (802.11)**、**交换机**、**网桥** | **帧** (Frame)                                     |
| **1. 物理层**     | 负责在物理介质上传输原始的**比特流**（0和1）。**定义电气、机械和时序接口等规范。** | 双绞线（网线）、同轴电缆、光纤、无线电波、**集线器 (Hub)**   |                                                    |

### 数据封装与解封装的过程

当你在浏览器中输入网址访问一个网页时，数据会经历如下过程：

**发送端（你的电脑） - 封装 (Encapsulation)：**

1. 1.**应用层**：你的浏览器生成一个 **HTTP 请求**（“请把首页发给我”）。
2. 2.**传输层**：HTTP 请求被交给 **TCP**。TCP 将数据分段，并为每个段加上 **TCP 头部**（包含**源端口、目标端口80**等信息），形成 **TCP 段**。该头部确保了数据的可靠传输。
3. 3.**网络层**：TCP 段被交给 **IP**。IP 加上 **IP 头部**（包含**源IP地址、目标IP地址**等信息），形成 **IP 包**。该头部用于网络间的路由。
4. 4.**数据链路层**：IP 包被交给 **以太网** 协议。加上 **以太网头部和尾部**（包含**源MAC地址、目标MAC地址（通常是当前网络的网关路由器MAC）** 和差错校验码），形成 **以太网帧**。
5. 5.**物理层**：将帧转换成 **01 比特流**，通过网线或WiFi射频信号发送出去。

**接收端（服务器） - 解封装 (Decapsulation)：**

过程与发送端完全相反，逐层剥离头部，将数据向上传递。

1. 1.**物理层**：接收到比特流，将其重组为数据帧。
2. 2.**数据链路层**：查看帧的 **MAC 地址**，如果是发往自己的，就剥离帧头和帧尾，将内部的 **IP 包**向上传递给网络层。
3. 3.**网络层**：查看 **IP 包** 的 **IP 地址**，如果是发往自己的，就剥离IP头，将内部的 **TCP 段**向上传递给传输层。
4. 4.**传输层**：查看 **TCP 段** 的**端口号**（这里是80），确定是哪个应用程序（Web服务程序）的数据，然后剥离TCP头，将内部的 **HTTP 请求**向上传递给应用层的Web服务程序。
5. 5.**应用层**：Web服务程序解析 **HTTP 请求**，然后准备 **HTTP 响应**，再重复上述封装过程，将网页内容发回给你的电脑。

### 总结

TCP/IP 五层模型是一个概念上的框架，它帮助我们：

- •**化繁为简**：将复杂的网络通信过程分解成更小、更易于管理的部分。
- •**独立发展**：每一层只需关心自己的任务，并使用下层提供的服务，层与层之间相互独立。例如，IP协议从IPv4升级到IPv6，上层的TCP和HTTP无需改动。
- •** troubleshooting**：当网络出现问题时，可以分层进行排查，极大地提高了效率。