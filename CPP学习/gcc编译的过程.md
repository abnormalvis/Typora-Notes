GCC编译过程主要分为四个阶段，让我们详细了解一下：

## 1. 预处理 (Preprocessing)

**作用**：处理源代码中的预处理指令
```bash
gcc -E hello.c -o hello.i
```

**处理内容**：
- 展开头文件 `#include`
- 宏替换 `#define`
- 条件编译 `#if`, `#ifdef`
- 删除注释
- 添加行号信息

**输入**：`.c` 文件  
**输出**：`.i` 文件（预处理后的C代码）

## 2. 编译 (Compilation)

**作用**：将预处理后的代码转换为汇编代码
```bash
gcc -S hello.i -o hello.s
```

**处理内容**：
- 词法分析
- 语法分析
- 语义分析
- 中间代码生成
- 代码优化
- 目标代码生成

**输入**：`.i` 文件  
**输出**：`.s` 文件（汇编代码）

## 3. 汇编 (Assembly)

**作用**：将汇编代码转换为机器代码（目标文件）
```bash
gcc -c hello.s -o hello.o
```

**处理内容**：
- 将汇编指令转换为机器指令
- 生成可重定位的目标代码

**输入**：`.s` 文件  
**输出**：`.o` 文件（目标文件）

## 4. 链接 (Linking)

**作用**：将多个目标文件和库文件连接成可执行文件
```bash
gcc hello.o -o hello
```

**处理内容**：
- 地址和空间分配
- 符号解析
- 重定位
- 链接库文件

**输入**：`.o` 文件 + 库文件  
**输出**：可执行文件

## 完整编译示例

```c
// hello.c
#include <stdio.h>
#define MSG "Hello World"

int main() {
    printf("%s\n", MSG);
    return 0;
}
```

**一步编译**：
```bash
gcc hello.c -o hello
```

**分步编译**：
```bash
gcc -E hello.c -o hello.i    # 预处理
gcc -S hello.i -o hello.s    # 编译
gcc -c hello.s -o hello.o    # 汇编
gcc hello.o -o hello         # 链接
```

## 常用编译选项

| 选项              | 说明                       |
| ----------------- | -------------------------- |
| `-o <file>`       | 指定输出文件名             |
| `-c`              | 只编译不链接，生成目标文件 |
| `-E`              | 只进行预处理               |
| `-S`              | 只编译到汇编阶段           |
| `-g`              | 包含调试信息               |
| `-O0/-O1/-O2/-O3` | 优化级别                   |
| `-Wall`           | 开启所有警告               |
| `-I<dir>`         | 指定头文件搜索目录         |
| `-L<dir>`         | 指定库文件搜索目录         |
| `-l<lib>`         | 链接指定的库               |

这个编译过程确保了源代码能够被正确转换为计算机可以执行的机器代码。